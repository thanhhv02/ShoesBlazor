@page "/updateUser/{Id}"
@inject IAuthService Authservice
@inject NavigationManager NavigationManager

@if (ShowErrors)
{
    <span class="alert alert-danger">@Message</span>
}
else
{
    <h1 class="mt-4 ml-3 mb-3">Cập nhật người dùng</h1>
    <div class="card-body ml-3">
        <EditForm Model="User" OnValidSubmit="UpdateUser">
            <DataAnnotationsValidator></DataAnnotationsValidator>
            <div class="form-group">
                <label for="lastname">Họ</label>
                <InputText id="lastname" class="form-control" @bind-Value="User.UserName"></InputText>
                <ValidationMessage For="()=> User.UserName"></ValidationMessage>
            </div>
            <div class="form-group">
                <label for="firstname">Tên</label>
                <InputText id="firstname" class="form-control" @bind-Value="User.FirstName"></InputText>
                <ValidationMessage For="()=> User.FirstName"></ValidationMessage>
            </div>
            <div class="form-group">
                <label for="dob">Ngày tháng sinh</label>
                <InputDate id="dob" class="form-control" @bind-Value="User.Dob"></InputDate>
                <ValidationMessage For="()=> User.Dob"></ValidationMessage>
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <InputText id="email" class="form-control" @bind-Value="User.Email"></InputText>
                <ValidationMessage For="()=> User.Email"></ValidationMessage>
            </div>
            <div class="form-group">
                <label for="phonenumber">Số điện thoại</label>
                <InputText id="phonenumber" class="form-control" @bind-Value="User.PhoneNumber"></InputText>
                <ValidationMessage For="()=> User.PhoneNumber"></ValidationMessage>
            </div>
            <div class="form-group">
                <label for="username">Username</label>
                <InputText id="username" class="form-control" @bind-Value="User.UserName"></InputText>
                <ValidationMessage For="()=> User.UserName"></ValidationMessage>
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <InputText id="password" type="password" class="form-control" @bind-Value="User.Password"></InputText>
                <ValidationMessage For="()=> User.Password"></ValidationMessage>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Lưu lại</button>
        </EditForm>
    </div>
}


@code {
    [Parameter]
    public string Id { get; set; }
    public UserVM User = new UserVM();
    public bool ShowErrors = false;
    public string Message;

    protected async override Task OnInitializedAsync()
    {
        User = await Authservice.GetUserById(Guid.Parse(Id));
    }

    private async Task UpdateUser()
    {
        var result = await Authservice.UpdateUser(User);
        if (result)
        {
            NavigationManager.NavigateTo("/listUser");
        }
        else
        {
            ShowErrors = true;
            Message = "Cập nhật không thành công";
        }
    }
}
